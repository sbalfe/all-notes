# Chapter 2 - Setting Up A project

- Collection files $\to$ use `CMakeLists.txt` to define:
  1. How they are built?
  2. Tests?
  3. Packages to create?
- This is **platform independent** $\to$ cmake turns to **platform depenedent** 
- Controls the core functionality of CMake.

---

- Fundamental idea is a **source directory** and **binary directory**

  1. Source $\to$ where `CMakeLists.txt` is located along with other source files required
     - Often under version control such as *git.*
  2. Binary $\to$ Where everything generated by the build is **created**
     - Known as the `build` directory.
     - Stores Executables / Libraries / test output / packages.
     - Contains `CMakeCache.txt` in build directory for **various information** on *subsequent reruns*.

- Before commencing with a project $\to$ must **specify location** of the *build / binary directory* with relation to the **source directory**.

  1. In Source

  2. Out Source

## In-Source Builds

- The **source / build** directories are **the same**.
- Build outputs are **mixed in** with **source** leading to **cluttering of files** and **subdirectories**.
- Overall **harder to manage the project**
- Build outputs may **overwrite source files**.
- Makes **version control** more confusing.
- Not easy to clear build output and start with a **clean slate**.
- **Not encouraged** for any projects.

## Out-Source Builds

- Source and build directories are **different**.
- Can create **multiple build directories** for the **same source directory**.
  - Enables different **options**
    1. Debug
    2. Release
    3. etc...
- Pattern below shows a parent with the source / build directories:

![image](https://github.com/sbalfe/all-notes/blob/master/images/image-20220210045042528.png)

- **build directory** may be a **subdirectory** of the **source directory**
  - Not reccomended.

## Generating project files

- Developer now **runs** `CMake` 
  - Reads the `CMakeLists.txt` file $\to$ creates the **project files** in the **build directory**
- Developer selects the **type** of *project file* to be created
  - Choosing a **particular** *project file* **==generator==** 

- There are **a range** of *different* generators
  - More **common ones** are *listed* in the **table below**

![image](https://github.com/sbalfe/all-notes/blob/master/images/image-20220210045431199.png)

- May support **multi configurations** (*debug / release*)
  - Choose **build configurations** without *rerunning CMake*.
    - Suitable for **IDE** *generators*.
- Most basic method to **run Cmake** is via `cmake` command utility
  - Invoke by **changing** to the *build directory* and **pass options** to `cmake` for the **generator type** and **location** of the *source tree*.

```bash
mkdir build
cd build
cmake -G "Unix Makefiles" ../source
```

- *Omission* of `-G` $\to$ CMake selects a **default generator type** based on the **host platform**
  - Using a *later CMake* $\to$ override by setting `CMAKE_GENERATOR` environment variable.

---

- For *any generator*
  - `CMake` carries out **a series of tests** to determine **how to setup** the *project files*
    - Includes tasks such as:
      1. Verfying working compilers
      2. Determining compiler features
      3. ....
- Lots of **information** is *logged* before *CMake* finishes with **lines** such as:

```bash
-- Configuring done # cmake reads CMakeLists.txt to build internal representation
-- Generating done # creates the project files
-- Build files have been written to: /some/path/build
```

- CMake then runs `CMakeCache.txt` file in the **build directory**
  - Saves details if it **requires to run again**.
- `cmake-gui` an **alternative** to running `cmake` command line tool.

## Running The Build Tool

- Project files **now available** 
- `build` directory contains the **neccessary project files** to be *loaded* into some **IDE** or read by **command line tools**.
- `cmake` can run `build` on the behal of the user

```bash
cmake --build /pathTo/build --config Debug --target MyApp
```

- `--build` $\to$ points to the **build directory** used by the **CMake** project generation step
- For *multi configuration* $\to$ `--config` specifies the **configuration** to build, single configuration **ignore this**.
- `--target` tells the build tool **what is to be built**, if omitted then **default is selected**.
  - Can list **multiple targets** underneath this.

---

- Use this approach to generate some **scripted build**:

```bash
mdkir build
cd build
cmake -G "Unix Makefiles" ../source
cmake --build . --config Release --target MyApp
```

- Changing `-G` enables us to **alter generators** and thus change to the **approriate build tool**.

## Recommended practices

- Keep **build** directory *seperate* from the **source tree**
  - Setup Debug / Release builds each build configured with the **appropriate settings** 
- Using **different generators**.
  - Catch *unintended* dependencies on some **particular build tool** or to *check* for **differing** *compiler* settings between **generator types**

---

- Tempted to focus on a **single project generator** in early project stages, especially for **lack of cross platform experience**.
- Projects often **expand** beyond the **intended scope**.
- Periodically checking a build is successful in different generators is useful.
- Ninja is the broadest and most efficient build generator.
